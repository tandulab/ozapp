import{aj as me,d as se,o as i,e as $,w as m,i as pe,G as ve,c as v,a as r,f as l,k as h,t as f,u as c,v as R,C as _,r as w,ai as fe,j as _e,y as ge,b as be,z as we,F as he,ad as ye,q as ae,x as xe,D as ke,T as Ce}from"../index47801.js";import{b as le,u as Ve,T,L as Se,a as $e,s as De}from"./LazyDataTable47801.js";import{a as ze}from"./index478016.js";import{a as Fe,s as Me}from"./index478017.js";import{s as Te}from"./index478013.js";import{d as H,b as Ue}from"./date47801.js";import{u as We}from"./user47801.js";import{u as ne}from"./settings47801.js";function Pe(t){me.config.globalProperties.$confirm.require({header:t.header,group:"confirm-dialog",message:t.message,accept(){var s;(s=t.acceptCallback)==null||s.call(t)},reject(){var s;(s=t.rejectCallback)==null||s.call(t)}})}const qe={key:0,class:"mb-5"},Oe={key:1,class:"mb-5"},Le={key:2,class:"mb-5"},je={class:"mb-5 flex flex-col"},Ee={class:"mb-5 flex flex-col"},Be={class:"mb-5 flex flex-col"},Ne={class:"mb-5 flex flex-col"},Ae={key:3,class:"mb-5 flex flex-col"},Qe=se({__name:"WarningDetailDialog",props:{item:Object,visible:Boolean},emits:["update:visible"],setup(t,{emit:p}){const s=ne(),D=p;function k(){D("update:visible",!1)}return(K,a)=>{const y=pe("router-link"),I=le,g=ve;return i(),$(g,{visible:t.visible,modal:"",style:{width:"25rem"},header:"Dettaglio segnalazione",class:"m-w-[450px]",closable:!0,"onUpdate:visible":a[0]||(a[0]=z=>k())},{default:m(()=>{var z,O,L,j,E,B,F,N,M,U,C,W,b,A,Q;return[(z=t.item)!=null&&z.warning_user?(i(),v("div",qe,[a[1]||(a[1]=r("p",{class:"mb-0! uppercase text-sm font-bold"},"Utente segnalato:",-1)),l(y,{class:"hover:text-primary",to:{name:c(R).utentiDettaglio,params:{id:(L=(O=t.item)==null?void 0:O.warning_user)==null?void 0:L.id}}},{default:m(()=>{var V,x;return[h(f((x=(V=t.item)==null?void 0:V.warning_user)==null?void 0:x.full_name),1)]}),_:1},8,["to"])])):_("",!0),(j=t.item)!=null&&j.warning_video_id?(i(),v("div",Oe,[a[3]||(a[3]=r("p",{class:"mb-0! uppercase text-sm font-bold"},"Media segnalato:",-1)),l(y,{class:"hover:text-primary",to:{name:c(R).mediaDettaglio,params:{id:(E=t.item)==null?void 0:E.warning_video_id}}},{default:m(()=>a[2]||(a[2]=[h("-")])),_:1},8,["to"])])):_("",!0),(B=t.item)!=null&&B.warning_comment_id?(i(),v("div",Le,[a[4]||(a[4]=r("p",{class:"mb-0! uppercase text-sm font-bold"},"Commento segnalato:",-1)),h(" "+f((F=t.item.warning_comment)==null?void 0:F.text),1)])):_("",!0),r("div",je,[a[5]||(a[5]=r("p",{class:"mb-0! uppercase text-sm font-bold"}," Segnalazione aperta da: ",-1)),l(y,{class:"hover:text-primary",to:{name:c(R).utentiDettaglio,params:{id:(M=(N=t.item)==null?void 0:N.user)==null?void 0:M.id}}},{default:m(()=>{var V,x;return[h(f((x=(V=t.item)==null?void 0:V.user)==null?void 0:x.full_name),1)]}),_:1},8,["to"])]),r("div",Ee,[a[6]||(a[6]=r("p",{class:"mb-0! uppercase text-sm font-bold"}," Motivo della segnalazione: ",-1)),h(" "+f(((U=t.item)==null?void 0:U.warning_note)||"-"),1)]),r("div",Be,[a[7]||(a[7]=r("p",{class:"mb-1! uppercase text-sm font-bold"}," Stato della segnalazione: ",-1)),r("div",null,[l(I,{value:c(s).getPrettyWarningStatus((C=t.item)==null?void 0:C.open),severity:c(s).getColorVideoStatus(!((W=t.item)!=null&&W.open))},null,8,["value","severity"])])]),r("div",Ne,[a[8]||(a[8]=r("p",{class:"mb-0! uppercase text-sm font-bold"}," Data apertura segnalazione: ",-1)),h(" "+f(c(H)((b=t.item)==null?void 0:b.created_at)),1)]),(A=t.item)!=null&&A.closed_at?(i(),v("div",Ae,[a[9]||(a[9]=r("p",{class:"mb-0! uppercase text-sm font-bold"}," Data chiusura segnalazione: ",-1)),h(" "+f(c(H)((Q=t.item)==null?void 0:Q.closed_at)),1)])):_("",!0)]}),_:1},8,["visible"])}}}),Ge={key:0,class:"flex flex-col mb-8"},Ie={key:0,class:"flex items-center gap-2"},Re={key:1,class:"crop"},He={key:2,class:"truncate overflow-hidden text-ellipsis w-[200px]"},Ke={key:0},Je={key:1},Xe={key:2},Ye={class:"flex items-center gap-2"},Ze={class:"flex items-center justify-center"},et={key:1,class:"w-[35px] h-[35px]"},tt={class:"flex items-center justify-center"},oe=10,dt=se({__name:"WarningTable",props:{video_id:{},user_id:{}},setup(t){const p=t,s=w(),D=w(),k=w([{name:"Utenti",code:"user"},{name:"Media",code:"video"},{name:"Commenti",code:"comment"}]),K=w([{label:"Aperta",value:!0},{label:"Chiusa",value:!1}]),a=w(!1),y=fe(),I=We(),g=ne(),z=ye(),{warnings:O,totalWarnings:L}=_e(y),{onSort:j,onPage:E,onFilter:B,loadLazyData:F,isLoading:N}=Ve({rows:oe},Q),M=w(!1),U=w(),C=w(void 0),W=ge(()=>I.users),b=w({id:{value:"",matchMode:T.EQ},user_id:{value:"",matchMode:T.EQ},open:{value:"",matchMode:T.EQ},created_at:{value:null,matchMode:T.GTE},warning_type:{value:"",matchMode:T.EQ},warning_user_id:{value:"",matchMode:T.EQ}});function A(){B(b.value)}async function Q(o){var u;try{if(p.video_id&&o.set("warning_video_id_eq",p.video_id),p.user_id&&o.set("warning_user_id_eq",p.user_id),b.value.user_id.value&&o.set("user_id_eq",b.value.user_id.value.id),(u=s==null?void 0:s.value)!=null&&u.code)switch(s.value.code){case"user":o.set("warning_user_id_neq","null");break;case"video":o.set("warning_video_id_neq","null");break;case"comment":o.set("warning_comment_id_neq","null");break}else!p.video_id&&!p.user_id&&o.set("warning_user_id_neq","null");b.value.created_at.value&&(o=Ue(o,"created_at",b.value.created_at.value)),await y.fetchWarnings(o)}catch(P){console.error(P)}}async function V(o){try{await y.closeWarning(o),F(),ke("Segnalazione chiusa con successo"),await y.fetchWarningsCounter()}catch(u){console.error(u)}}const x=o=>{setTimeout(()=>{o.query.trim().length?D.value=W.value.filter(u=>u.full_name.toLowerCase().startsWith(o.query.toLowerCase())):D.value=[...W.value]},250)};function J(){switch(s.value.code){case"video":C.value=g.getVideoWarningTypes()||[];break;case"comment":C.value=g.getCommentWarningTypes();break;case"user":C.value=g.getUserWarningTypes();break}}function X(){const o=z.fullPath;switch(!0){case o.includes("/commenti"):s.value=k.value[2],a.value=!0;break;case o.includes("/utenti"):s.value=k.value[0],a.value=!0;break;case o.includes("/media"):s.value=k.value[1],a.value=!0;break;default:s.value=k.value[0],a.value=!1;break}}function ie(o){Pe({message:"Stai per chiudere la segnalazione. Vuoi confermare l'operazione?",header:"Chiudi segnalazione",acceptCallback(){V(o)}})}function re(o){U.value=o,M.value=!0}return be(()=>{X(),J()}),we(()=>[p.video_id,p.user_id,z.fullPath],()=>{X(),F()},{immediate:!0}),(o,u)=>{const P=$e,Y=Fe,G=Te,ue=Me,S=De,de=ze,ce=le,Z=xe,ee=Ce;return i(),v(he,null,[r("div",null,[!p.user_id&&!p.video_id&&!a.value?(i(),v("div",Ge,[u[4]||(u[4]=r("label",{for:"warnings_type",class:"text-muted-color font-500 mb-1"},"Tipo di segnalazione",-1)),l(P,{modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=e=>s.value=e),options:k.value,optionLabel:"name",class:"w-full md:w-60",onChange:u[1]||(u[1]=e=>{J(),c(F)()})},null,8,["modelValue","options"])])):_("",!0),l(Se,{value:c(O),rows:oe,"total-records":c(L),onSort:c(j),onPage:c(E),onFilter:A,filters:b.value,"onUpdate:filters":u[2]||(u[2]=e=>b.value=e),"data-key":"id",scrollable:"",loading:c(N),rowHover:!0,showGridlines:""},{empty:m(()=>u[5]||(u[5]=[h("Non ci sono segnalazioni")])),default:m(()=>[!o.user_id&&!o.video_id?(i(),$(S,{key:0,class:"min-w-[200px]","filter-field":"warning_user_id",header:s.value.code=="video"?"Media segnalato":s.value.code=="user"?"Utente segnalato":"Commento segnalato",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:m(({filterModel:e,filterCallback:d})=>[l(Y,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,optionLabel:"full_name",optionValue:"id",suggestions:D.value,onComplete:x,onOptionSelect:n=>d(),dataKey:"id",onClear:n=>d()},null,8,["modelValue","onUpdate:modelValue","suggestions","onOptionSelect","onClear"])]),body:m(({data:e})=>{var d,n,q,te;return[e.warning_user_id?(i(),v("div",Ie,[(d=e.warning_user)!=null&&d.profile_picture_url?(i(),$(G,{key:0,image:(n=e.warning_user)==null?void 0:n.profile_picture_url,style:{width:"32px"},shape:"circle"},null,8,["image"])):e.warning_user?(i(),$(G,{key:1,class:"mr-2 text-sm!",size:"width: 32px",shape:"circle"})):_("",!0),r("span",null,f((q=e.warning_user)==null?void 0:q.full_name),1)])):_("",!0),e.warning_video?(i(),v("div",Re,[l(ue,{src:(te=e.warning_video)==null?void 0:te.attachment_img_preview_url,alt:"Image",width:"250",preview:""},null,8,["src"])])):_("",!0),e.warning_comment?(i(),v("div",He,f(e.warning_comment.text),1)):_("",!0)]}),_:1},8,["header"])):_("",!0),l(S,{class:"min-w-[200px]",header:"Tipo",field:"warning_type",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:m(({filterModel:e,filterCallback:d})=>[l(P,{class:"w-[200px]",modelValue:e.value,"onUpdate:modelValue":[n=>e.value=n,d],options:C.value,"option-label":"labels.it","option-value":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),body:m(({data:e})=>[e.warning_video_id?(i(),v("div",Ke,f(c(g).getPrettyVideoWarningTypes(e.warning_type+"")),1)):e.warning_user_id?(i(),v("div",Je,f(c(g).getPrettyUserWarningTypes(e.warning_type+"")),1)):(i(),v("div",Xe,f(c(g).getPrettyCommentWarningTypes(e.warning_type+"")),1))]),_:1}),l(S,{class:"min-w-[100px]",header:"Data apertura",field:"created_at",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:m(({filterModel:e,filterCallback:d})=>[l(de,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,dateFormat:"dd/mm/yy",placeholder:"Filtra",onDateSelect:n=>d()},null,8,["modelValue","onUpdate:modelValue","onDateSelect"])]),body:m(({data:e})=>[h(f(c(H)(e.created_at)),1)]),_:1}),l(S,{class:"min-w-[200px]","filter-field":"user_id",header:"Utente segnalatore",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:m(({filterModel:e,filterCallback:d})=>[l(Y,{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,optionLabel:"full_name",optionValue:"id",suggestions:D.value,onComplete:x,onOptionSelect:n=>d(),dataKey:"id",onClear:n=>d()},null,8,["modelValue","onUpdate:modelValue","suggestions","onOptionSelect","onClear"])]),body:m(({data:e})=>{var d,n,q;return[r("div",Ye,[(d=e.user)!=null&&d.profile_picture_url?(i(),$(G,{key:0,image:(n=e.user)==null?void 0:n.profile_picture_url,style:{width:"32px"},shape:"circle"},null,8,["image"])):e.user?(i(),$(G,{key:1,class:"mr-2 text-sm!",size:"width: 32px",shape:"circle"})):_("",!0),r("span",null,f((q=e.user)==null?void 0:q.full_name),1)])]}),_:1}),l(S,{class:"min-w-[100px]",header:"Stato",field:"open",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!0},{filter:m(({filterModel:e,filterCallback:d})=>[l(P,{class:"w-[100px]",modelValue:e.value,"onUpdate:modelValue":[n=>e.value=n,d],options:K.value,"option-label":"label","option-value":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),body:m(({data:e})=>[l(ce,{value:c(g).getPrettyWarningStatus(e.open),severity:c(g).getColorVideoStatus(!e.open)},null,8,["value","severity"])]),_:1}),l(S,{class:"w-[50px]","align-frozen":"right",frozen:""},{body:m(({data:e})=>[r("div",Ze,[e.open?ae((i(),$(Z,{key:0,type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-lock",text:"",rounded:"",severity:"secondary",onClick:d=>ie(e.id)},null,8,["onClick"])),[[ee,"Chiudi segnalazione",void 0,{top:!0}]]):(i(),v("div",et))])]),_:1}),l(S,{class:"w-[50px]","align-frozen":"right",frozen:""},{body:m(({data:e})=>[r("div",tt,[ae(l(Z,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-arrow-right",text:"",rounded:"",onClick:d=>re(e)},null,8,["onClick"]),[[ee,"Dettaglio",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","total-records","onSort","onPage","filters","loading"])]),l(Qe,{item:U.value,visible:M.value,"onUpdate:visible":u[3]||(u[3]=e=>M.value=e)},null,8,["item","visible"])],64)}}});export{dt as _,Pe as s};
